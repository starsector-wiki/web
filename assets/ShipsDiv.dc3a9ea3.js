import{Q as z}from"./QBtn.ce1b7494.js";import{I as R,r as _,Y as C,J as D,K as r,U as l,Q as h,Z as y,X as f,V as $,N as M,W as g,_ as S,R as A,S as U,$ as W,L as N,M as H,a0 as V}from"./index.2981bf06.js";import{c as O}from"./utils.b3f61203.js";import{_ as Q}from"./WeaponSpriteDiv.22d4cd5d.js";const T=["src"],F={key:1},Y=R({name:"ShipSpriteDiv",__name:"ShipSpriteDiv",props:{ship:{}},setup(p){const m=_(void 0),v=_(void 0),n=_(void 0);C(()=>{d(),u(),c()});async function d(){const i=[];for(const[s,o]of p.ship.weaponIdMap.entries())if(o){const t=g.getWeaponById(o),e=p.ship.allWeaponSlots.find(a=>a.id===s);if(t&&e){const a=await g.getWeaponCanvas(t,e.hardPoint);a&&i.push([t,e,a])}}m.value=i.sort((s,o)=>{const t=s[1].location,e=o[1].location;return t.x!==e.x?Math.abs(t.x)-Math.abs(e.x):Math.abs(t.y)-Math.abs(e.y)})}async function u(){let i=[];if(p.ship.station){for(const[s,o]of p.ship.moduleIdMap.entries())if(o){const t=g.getShipById(o),e=p.ship.allWeaponSlots.find(a=>a.id===s);if(t&&e){const a=await g.getShipCanvas(t);i.push([t,e,a])}}i=i.sort((s,o)=>{const t=s[0],e=o[0];if(t.isUnderParent()!==e.isUnderParent())return t.isUnderParent()?-1:1;if(t.isEmptyModule()!==e.isEmptyModule())return t.isEmptyModule()?-1:1;const a=s[1].location,x=o[1].location;return a.x!==x.x?Math.abs(x.x)-Math.abs(a.x):Math.abs(x.y)-Math.abs(a.y)})}v.value=i}async function c(){n.value=await O(p.ship)}return(i,s)=>{const o=D("ShipSpriteDiv",!0);return n.value&&v.value&&m.value?(r(),l("div",{key:0,style:y({position:"relative",width:n.value.left+n.value.right+"px",height:n.value.top+n.value.bottom+"px"})},[h("img",{decoding:"async",src:i.ship.sprite,style:y({position:"absolute",left:n.value.left+"px",top:n.value.top+"px",transform:`translate(${-i.ship.center.left}px, calc(-100% + ${i.ship.center.bottom}px))`})},null,12,T),(r(!0),l(f,null,$(m.value,([t,e,a])=>(r(),l("div",{key:e.id,style:y({position:"absolute",left:n.value.left+"px",top:n.value.top+"px",transformOrigin:`${a.left}px ${a.top}px`,transform:`translate(${-a.left}px, ${-a.top}px) translate(${e.location.x}px, ${-e.location.y}px) rotate(${360-e.angle}deg)`})},[M(Q,{weapon:t,"is-hard-point":e.hardPoint},null,8,["weapon","is-hard-point"])],4))),128)),(r(!0),l(f,null,$(v.value,([t,e,a],x)=>{var b,I,k,w,E,B,L,P;return r(),l("div",{key:e.id,style:y({position:"absolute",left:n.value.left+"px",top:n.value.top+"px",transformOrigin:`calc(${a.left}px - ${(I=(b=t.moduleAnchor)==null?void 0:b.x)!=null?I:0}px) calc(${a.top}px - ${(w=(k=t.moduleAnchor)==null?void 0:k.y)!=null?w:0}px)`,transform:`translate(${-a.left}px, ${-a.top}px) translate(${(B=(E=t.moduleAnchor)==null?void 0:E.x)!=null?B:0}px, ${(P=(L=t.moduleAnchor)==null?void 0:L.y)!=null?P:0}px) translate(${e.location.x}px, ${-e.location.y}px) rotate(${e.angle===0?0:360-e.angle}deg)`,zIndex:t.isUnderParent()?-1:2+x})},[M(o,{ship:t},null,8,["ship"])],4)}),128))],4)):(r(),l("h1",F,"Loading..."))}}});const G={class:"items"},J={class:"item_img_section"},q=R({name:"ShipsDiv",__name:"ShipsDiv",props:{ships:{}},setup(p){const m=[S.FRIGATE,S.DESTROYER,S.CRUISER,S.CAPITAL_SHIP];function v(d){return p.ships.filter(u=>u.size==d).sort((u,c)=>u.id.localeCompare(c.id))}function n(d){return p.ships.filter(u=>u.size==d).length>0}return(d,u)=>(r(),l(f,null,$(m,c=>{var i;return r(),l(f,{key:c},[n(c)?(r(),l(f,{key:0},[h("h4",null,A((i=U(W).get(c))!=null?i:c),1),h("div",G,[(r(!0),l(f,null,$(v(c),s=>(r(),N(z,{"no-caps":"",flat:"",class:"item",key:s.id,to:{name:"ship",params:{id:s.id}}},{default:H(()=>[h("div",null,[h("div",J,[M(Y,{ship:s},null,8,["ship"])]),h("span",null,A(s.getDisplayName()),1)])]),_:2},1032,["to"]))),128))])],64)):V("",!0)],64)}),64))}});export{q as _,Y as a};
