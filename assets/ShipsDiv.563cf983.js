import{u as F,Q as D,a as Q}from"./use-quasar.e16a694c.js";import{Q as H}from"./QBtn.3bea4207.js";import{E as R,r as _,a1 as T,G as q,H as f,W as b,Y as x,X as O,$ as k,Z as P,a0 as I,a2 as G,K as g,a as C,J as A,P as U,O as W,_ as L,L as N,I as J,a3 as K,a4 as X}from"./index.f106f705.js";import{_ as Y}from"./WeaponSpriteDiv.f65f59cc.js";const Z=["src"],j={key:1},ee=R({name:"ShipSpriteDiv",__name:"ShipSpriteDiv",props:{ship:{}},setup(c){const $=_(void 0),p=_(void 0),o=_(void 0);T(()=>{z(),E(),S()});async function z(){const m=[];for(const[v,r]of c.ship.weaponIdMap.entries())if(r){const n=I.getWeaponById(r),e=c.ship.allWeaponSlots.find(t=>t.id===v);if(n&&e){const t=await I.getWeaponCanvas(n,e.hardPoint);t&&m.push([n,e,t])}}$.value=m.sort((v,r)=>{const n=v[1].location,e=r[1].location;return n.x!==e.x?Math.abs(n.x)-Math.abs(e.x):Math.abs(n.y)-Math.abs(e.y)})}async function E(){let m=[];if(c.ship.moduleIdMap.size>0){for(const[v,r]of c.ship.moduleIdMap.entries())if(r){const n=I.getShipById(r),e=c.ship.allWeaponSlots.find(t=>t.id===v);if(n&&e){const t=await I.getShipCanvas(n);m.push([n,e,t])}}m=m.sort((v,r)=>{const n=v[0],e=r[0];if(n.isUnderParent()!==e.isUnderParent())return n.isUnderParent()?-1:1;if(n.isEmptyModule()!==e.isEmptyModule())return n.isEmptyModule()?-1:1;const t=v[1].location,l=r[1].location;return t.x!==l.x?Math.abs(l.x)-Math.abs(t.x):Math.abs(l.y)-Math.abs(t.y)})}p.value=m}async function S(){o.value=await G(c.ship)}return(m,v)=>{const r=q("ShipSpriteDiv",!0);return o.value&&p.value&&$.value?(f(),b("div",{key:0,style:O({position:"relative",width:o.value.left+o.value.right+"px",height:o.value.top+o.value.bottom+"px"})},[x("img",{decoding:"async",src:c.ship.sprite,style:O({position:"absolute",left:o.value.left+"px",top:o.value.top+"px",transform:`translate(${-c.ship.center.left}px, calc(-100% + ${c.ship.center.bottom}px))`})},null,12,Z),(f(!0),b(k,null,P($.value,([n,e,t])=>(f(),b("div",{key:e.id,style:O({position:"absolute",left:o.value.left+"px",top:o.value.top+"px",transformOrigin:`${t.left}px ${t.top}px`,transform:`translate(${-t.left}px, ${-t.top}px) translate(${e.location.x}px, ${-e.location.y}px) rotate(${360-e.angle}deg)`})},[g(Y,{weapon:n,"is-hard-point":e.hardPoint},null,8,["weapon","is-hard-point"])],4))),128)),(f(!0),b(k,null,P(p.value,([n,e,t],l)=>{var u,B,M,a,i,s,d,y;return f(),b("div",{key:e.id,style:O({position:"absolute",left:o.value.left+"px",top:o.value.top+"px",transformOrigin:`calc(${t.left}px - ${(B=(u=n.moduleAnchor)==null?void 0:u.x)!=null?B:0}px) calc(${t.top}px - ${(a=(M=n.moduleAnchor)==null?void 0:M.y)!=null?a:0}px)`,transform:`translate(${-t.left}px, ${-t.top}px) translate(${(s=(i=n.moduleAnchor)==null?void 0:i.x)!=null?s:0}px, ${(y=(d=n.moduleAnchor)==null?void 0:d.y)!=null?y:0}px) translate(${e.location.x}px, ${-e.location.y}px) rotate(${e.angle===0?0:360-e.angle}deg)`,zIndex:n.isUnderParent()?-1:2+l})},[g(r,{ship:n},null,8,["ship"])],4)}),128))],4)):(f(),b("h1",j,"Loading..."))}}}),te={key:0,class:"filter-toolbar"},le={class:"filter-row"},ae={class:"filter-group"},ne={class:"filter-item"},oe={class:"filter-item"},ie={key:1,class:"result-count"},se={class:"card-item-list-page"},ue={class:"card-item-content"},ve=R({name:"ShipsDiv",__name:"ShipsDiv",props:{ships:{},hiddenOptions:{type:Boolean,default:!1}},setup(c){const $=F(),p=_(["type:normal"]),o=_([]),z=[{label:"\u666E\u901A",value:"normal"},{label:"\u7A7A\u95F4\u7AD9",value:"station"},{label:"\u6A21\u5757",value:"module"}],E=C(()=>c.ships.map(e=>typeof e=="string"?I.getShipById(e):e).filter(e=>e!==void 0).sort(K)),S=C(()=>{let e=E.value;return p.value&&p.value.length>0&&(e=e.filter(t=>p.value.every(l=>n(t,l)))),o.value&&o.value.length>0&&(e=e.filter(t=>!o.value.some(l=>n(t,l)))),e}),m=C(()=>{const e=S.value;return r(e,p.value,o.value)}),v=C(()=>{const e=S.value;return r(e,o.value,p.value)});function r(e,t,l){const u=[];return z.forEach(a=>{const i=`type:${a.value}`;let s=0;a.value==="station"?s=e.filter(h=>h.station).length:a.value==="module"?s=e.filter(h=>h.isModule).length:a.value==="normal"&&(s=e.filter(h=>!h.station&&!h.isModule).length);const d=t&&t.includes(i),y=l&&l.includes(i);u.push({label:`[\u7C7B\u578B] ${a.label}(${s})`,value:i,chipLabel:`[\u7C7B\u578B] ${a.label}`,disable:!d&&s===0||y})}),Array.from(new Set(E.value.map(a=>a.size))).forEach(a=>{var w;const i=(w=X.get(a))!=null?w:a,s=`size:${a}`,d=e.filter(V=>V.size===a).length,y=t&&t.includes(s),h=l&&l.includes(s);u.push({label:`[\u5927\u5C0F] ${i}(${d})`,value:s,chipLabel:`[\u5927\u5C0F] ${i}`,disable:!y&&d===0||h})}),Array.from(new Set(E.value.map(a=>{var i;return(i=a.manufacturer)!=null?i:null}))).sort((a,i)=>{const s=a!=null?a:"",d=i!=null?i:"";return s.localeCompare(d)}).forEach(a=>{const i=a&&a.length>0?a:"\u672A\u77E5",s=`manufacturer:${a!=null?a:"null"}`,d=e.filter(w=>{var V;return((V=w.manufacturer)!=null?V:null)===a}).length,y=t&&t.includes(s),h=l&&l.includes(s);u.push({label:`[\u8BBE\u8BA1\u7C7B\u578B] ${i}(${d})`,value:s,chipLabel:`[\u8BBE\u8BA1\u7C7B\u578B] ${i}`,disable:!y&&d===0||h})}),u}function n(e,t){var B;const[l,u]=t.split(":");if(l==="type"){if(u==="station")return e.station;if(u==="module")return e.isModule;if(u==="normal")return!e.station&&!e.isModule}else{if(l==="size")return e.size===u;if(l==="manufacturer"){const M=u==="null"?null:u;return((B=e.manufacturer)!=null?B:null)===M}}return!1}return(e,t)=>(f(),b(k,null,[c.hiddenOptions?W("",!0):(f(),b("div",te,[x("div",le,[x("div",ae,[x("div",ne,[t[2]||(t[2]=x("div",{class:"filter-item-label"},"\u5305\u542B\u6761\u4EF6",-1)),g(D,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=l=>p.value=l),options:m.value,multiple:"","emit-value":"","map-options":"","use-chips":"",dense:"","options-dense":"",behavior:U($).screen.lt.sm?"dialog":"menu",clearable:"","clear-icon":"close",placeholder:"\u9009\u62E9\u9700\u8981\u5305\u542B\u7684\u6761\u4EF6"},{"selected-item":A(l=>[g(Q,{removable:"",dense:"",onRemove:u=>l.removeAtIndex(l.index),tabindex:l.tabindex,color:"primary","text-color":"white"},{default:A(()=>[N(L(l.opt.chipLabel||l.opt.label),1)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","options","behavior"])]),x("div",oe,[t[3]||(t[3]=x("div",{class:"filter-item-label"},"\u6392\u9664\u6761\u4EF6",-1)),g(D,{modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=l=>o.value=l),options:v.value,multiple:"","emit-value":"","map-options":"","use-chips":"",dense:"","options-dense":"",behavior:U($).screen.lt.sm?"dialog":"menu",clearable:"","clear-icon":"close",placeholder:"\u9009\u62E9\u9700\u8981\u6392\u9664\u7684\u6761\u4EF6"},{"selected-item":A(l=>[g(Q,{removable:"",dense:"",onRemove:u=>l.removeAtIndex(l.index),tabindex:l.tabindex,color:"negative","text-color":"white"},{default:A(()=>[N(L(l.opt.chipLabel||l.opt.label),1)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","options","behavior"])])])])])),c.hiddenOptions?W("",!0):(f(),b("div",ie," \u5171 "+L(S.value.length)+" \u4E2A\u7ED3\u679C ",1)),x("div",se,[(f(!0),b(k,null,P(S.value,l=>(f(),J(H,{"no-caps":"",flat:"",class:"card-item",style:{"align-self":"stretch"},key:l.id,to:{name:"ship",params:{id:l.id}}},{default:A(()=>[x("div",ue,[g(ee,{ship:l},null,8,["ship"]),x("span",null,L(l.getDisplayName()),1)])]),_:2},1032,["to"]))),128))])],64))}});export{ve as _,ee as a};
