import{u as L,Q as I}from"./use-quasar.ad376913.js";import{Q as N}from"./QBtn.1a2e21ed.js";import{E as U,r as $,a0 as P,F as W,G as p,V as m,X as x,W as A,_ as w,Y as _,$ as B,a1 as D,J as S,a as M,O,N as V,H as Q,I as F,Z as T,a2 as H,a3 as q,a4 as G}from"./index.407d4528.js";import{_ as J}from"./WeaponSpriteDiv.c6951e47.js";const R=["src"],X={key:1},Y=U({name:"ShipSpriteDiv",__name:"ShipSpriteDiv",props:{ship:{}},setup(h){const g=$(void 0),v=$(void 0),i=$(void 0);P(()=>{y(),E(),k()});async function y(){const u=[];for(const[c,s]of h.ship.weaponIdMap.entries())if(s){const n=B.getWeaponById(s),a=h.ship.allWeaponSlots.find(l=>l.id===c);if(n&&a){const l=await B.getWeaponCanvas(n,a.hardPoint);l&&u.push([n,a,l])}}g.value=u.sort((c,s)=>{const n=c[1].location,a=s[1].location;return n.x!==a.x?Math.abs(n.x)-Math.abs(a.x):Math.abs(n.y)-Math.abs(a.y)})}async function E(){let u=[];if(h.ship.moduleIdMap.size>0){for(const[c,s]of h.ship.moduleIdMap.entries())if(s){const n=B.getShipById(s),a=h.ship.allWeaponSlots.find(l=>l.id===c);if(n&&a){const l=await B.getShipCanvas(n);u.push([n,a,l])}}u=u.sort((c,s)=>{const n=c[0],a=s[0];if(n.isUnderParent()!==a.isUnderParent())return n.isUnderParent()?-1:1;if(n.isEmptyModule()!==a.isEmptyModule())return n.isEmptyModule()?-1:1;const l=c[1].location,f=s[1].location;return l.x!==f.x?Math.abs(f.x)-Math.abs(l.x):Math.abs(f.y)-Math.abs(l.y)})}v.value=u}async function k(){i.value=await D(h.ship)}return(u,c)=>{const s=W("ShipSpriteDiv",!0);return i.value&&v.value&&g.value?(p(),m("div",{key:0,style:A({position:"relative",width:i.value.left+i.value.right+"px",height:i.value.top+i.value.bottom+"px"})},[x("img",{decoding:"async",src:u.ship.sprite,style:A({position:"absolute",left:i.value.left+"px",top:i.value.top+"px",transform:`translate(${-u.ship.center.left}px, calc(-100% + ${u.ship.center.bottom}px))`})},null,12,R),(p(!0),m(w,null,_(g.value,([n,a,l])=>(p(),m("div",{key:a.id,style:A({position:"absolute",left:i.value.left+"px",top:i.value.top+"px",transformOrigin:`${l.left}px ${l.top}px`,transform:`translate(${-l.left}px, ${-l.top}px) translate(${a.location.x}px, ${-a.location.y}px) rotate(${360-a.angle}deg)`})},[S(J,{weapon:n,"is-hard-point":a.hardPoint},null,8,["weapon","is-hard-point"])],4))),128)),(p(!0),m(w,null,_(v.value,([n,a,l],f)=>{var o,t,e,r,d,b,z,C;return p(),m("div",{key:a.id,style:A({position:"absolute",left:i.value.left+"px",top:i.value.top+"px",transformOrigin:`calc(${l.left}px - ${(t=(o=n.moduleAnchor)==null?void 0:o.x)!=null?t:0}px) calc(${l.top}px - ${(r=(e=n.moduleAnchor)==null?void 0:e.y)!=null?r:0}px)`,transform:`translate(${-l.left}px, ${-l.top}px) translate(${(b=(d=n.moduleAnchor)==null?void 0:d.x)!=null?b:0}px, ${(C=(z=n.moduleAnchor)==null?void 0:z.y)!=null?C:0}px) translate(${a.location.x}px, ${-a.location.y}px) rotate(${a.angle===0?0:360-a.angle}deg)`,zIndex:n.isUnderParent()?-1:2+f})},[S(s,{ship:n},null,8,["ship"])],4)}),128))],4)):(p(),m("h1",X,"Loading..."))}}}),Z={key:0,class:"filter-toolbar"},j={key:0,class:"filter-block"},K={key:1,class:"filter-block"},ee={key:2,class:"filter-block"},te={class:"card-item-list-page"},ae={class:"card-item-content"},ie=U({name:"ShipsDiv",__name:"ShipsDiv",props:{ships:{},hiddenOptions:{type:Boolean,default:!1}},setup(h){const g=L(),v=$([]),i=$([]),y=$(["normal"]),E=[{label:"\u666E\u901A",value:"normal"},{label:"\u7A7A\u95F4\u7AD9",value:"station"},{label:"\u6A21\u5757",value:"module"}],k=M(()=>{const o=f(l(s.value,i.value),y.value);return Array.from(new Set(s.value.map(e=>e.size))).map(e=>{var d;return{label:`${(d=H.get(e))!=null?d:e}(${a(o,[e]).length})`,value:e}})}),u=M(()=>{const o=f(a(s.value,v.value),y.value);return Array.from(new Set(s.value.map(e=>{var r;return(r=e.manufacturer)!=null?r:null}))).sort((e,r)=>{const d=e!=null?e:"",b=r!=null?r:"";return d.localeCompare(b)}).map(e=>({label:`${e&&e.length>0?e:"\u672A\u77E5"}(${l(o,[e]).length})`,value:e}))}),c=M(()=>{const o=l(a(s.value,v.value),i.value);return q(E,t=>f(o,[t]).length)}),s=M(()=>h.ships.map(o=>typeof o=="string"?B.getShipById(o):o).filter(o=>o!==void 0).sort(G)),n=M(()=>f(l(a(s.value,v.value),i.value),y.value));function a(o,t){return!t||t.length===0?o:o.filter(e=>t.includes(e.size))}function l(o,t){return!t||t.length===0?o:o.filter(e=>{var d;const r=(d=e.manufacturer)!=null?d:null;return t.includes(r)})}function f(o,t){return!t||t.length===0?o:o.filter(e=>{const r=e.station&&t.includes("station"),d=e.isModule&&t.includes("module"),b=!e.station&&!e.isModule&&t.includes("normal");return r||d||b})}return(o,t)=>(p(),m(w,null,[o.hiddenOptions?V("",!0):(p(),m("div",Z,[c.value.length?(p(),m("div",j,[t[3]||(t[3]=x("span",null,"\u7C7B\u578B:",-1)),S(I,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),options:c.value,multiple:"","emit-value":"","map-options":"","use-chips":"",dense:"","options-dense":"",behavior:O(g).screen.lt.sm?"dialog":"menu",clearable:"","clear-icon":"close","clear-value":[],placeholder:"\u5168\u90E8"},null,8,["modelValue","options","behavior"])])):V("",!0),k.value.length?(p(),m("div",K,[t[4]||(t[4]=x("span",null,"\u5927\u5C0F:",-1)),S(I,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value=e),options:k.value,multiple:"","emit-value":"","map-options":"","use-chips":"",dense:"","options-dense":"",behavior:O(g).screen.lt.sm?"dialog":"menu",clearable:"","clear-icon":"close","clear-value":[],placeholder:"\u5168\u90E8"},null,8,["modelValue","options","behavior"])])):V("",!0),u.value.length?(p(),m("div",ee,[t[5]||(t[5]=x("span",null,"\u8BBE\u8BA1\u7C7B\u578B:",-1)),S(I,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value=e),options:u.value,multiple:"","emit-value":"","map-options":"","use-chips":"",dense:"","options-dense":"",behavior:O(g).screen.lt.sm?"dialog":"menu",clearable:"","clear-icon":"close","clear-value":[],placeholder:"\u5168\u90E8"},null,8,["modelValue","options","behavior"])])):V("",!0)])),x("div",te,[(p(!0),m(w,null,_(n.value,e=>(p(),Q(N,{"no-caps":"",flat:"",class:"card-item",style:{"align-self":"stretch"},key:e.id,to:{name:"ship",params:{id:e.id}}},{default:F(()=>[x("div",ae,[S(Y,{ship:e},null,8,["ship"]),x("span",null,T(e.getDisplayName()),1)])]),_:2},1032,["to"]))),128))])],64))}});export{ie as _,Y as a};
