import{Q as U}from"./QOptionGroup.9b9ff4a9.js";import{Q as N}from"./QBtn.cf3eb392.js";import{I as C,r as S,Z as O,J as T,K as l,U as r,Q as d,V as x,X as c,W as $,N as M,Y as y,_ as m,a as P,O as W,R,S as D,$ as V,L as H,M as Q,a0 as F}from"./index.ab75060c.js";import{c as G}from"./utils.13a28e33.js";import{_ as Y}from"./WeaponSpriteDiv.b1d2dcf2.js";const q=["src"],J={key:1},K=C({name:"ShipSpriteDiv",__name:"ShipSpriteDiv",props:{ship:{}},setup(p){const f=S(void 0),u=S(void 0),s=S(void 0);O(()=>{b(),I(),v()});async function b(){const i=[];for(const[o,t]of p.ship.weaponIdMap.entries())if(t){const e=y.getWeaponById(t),a=p.ship.allWeaponSlots.find(n=>n.id===o);if(e&&a){const n=await y.getWeaponCanvas(e,a.hardPoint);n&&i.push([e,a,n])}}f.value=i.sort((o,t)=>{const e=o[1].location,a=t[1].location;return e.x!==a.x?Math.abs(e.x)-Math.abs(a.x):Math.abs(e.y)-Math.abs(a.y)})}async function I(){let i=[];if(p.ship.moduleIdMap.size>0){for(const[o,t]of p.ship.moduleIdMap.entries())if(t){const e=y.getShipById(t),a=p.ship.allWeaponSlots.find(n=>n.id===o);if(e&&a){const n=await y.getShipCanvas(e);i.push([e,a,n])}}i=i.sort((o,t)=>{const e=o[0],a=t[0];if(e.isUnderParent()!==a.isUnderParent())return e.isUnderParent()?-1:1;if(e.isEmptyModule()!==a.isEmptyModule())return e.isEmptyModule()?-1:1;const n=o[1].location,h=t[1].location;return n.x!==h.x?Math.abs(h.x)-Math.abs(n.x):Math.abs(h.y)-Math.abs(n.y)})}u.value=i}async function v(){s.value=await G(p.ship)}return(i,o)=>{const t=T("ShipSpriteDiv",!0);return s.value&&u.value&&f.value?(l(),r("div",{key:0,style:x({position:"relative",width:s.value.left+s.value.right+"px",height:s.value.top+s.value.bottom+"px"})},[d("img",{decoding:"async",src:i.ship.sprite,style:x({position:"absolute",left:s.value.left+"px",top:s.value.top+"px",transform:`translate(${-i.ship.center.left}px, calc(-100% + ${i.ship.center.bottom}px))`})},null,12,q),(l(!0),r(c,null,$(f.value,([e,a,n])=>(l(),r("div",{key:a.id,style:x({position:"absolute",left:s.value.left+"px",top:s.value.top+"px",transformOrigin:`${n.left}px ${n.top}px`,transform:`translate(${-n.left}px, ${-n.top}px) translate(${a.location.x}px, ${-a.location.y}px) rotate(${360-a.angle}deg)`})},[M(Y,{weapon:e,"is-hard-point":a.hardPoint},null,8,["weapon","is-hard-point"])],4))),128)),(l(!0),r(c,null,$(u.value,([e,a,n],h)=>{var w,z,E,_,k,L,A,B;return l(),r("div",{key:a.id,style:x({position:"absolute",left:s.value.left+"px",top:s.value.top+"px",transformOrigin:`calc(${n.left}px - ${(z=(w=e.moduleAnchor)==null?void 0:w.x)!=null?z:0}px) calc(${n.top}px - ${(_=(E=e.moduleAnchor)==null?void 0:E.y)!=null?_:0}px)`,transform:`translate(${-n.left}px, ${-n.top}px) translate(${(L=(k=e.moduleAnchor)==null?void 0:k.x)!=null?L:0}px, ${(B=(A=e.moduleAnchor)==null?void 0:A.y)!=null?B:0}px) translate(${a.location.x}px, ${-a.location.y}px) rotate(${a.angle===0?0:360-a.angle}deg)`,zIndex:e.isUnderParent()?-1:2+h})},[M(t,{ship:e},null,8,["ship"])],4)}),128))],4)):(l(),r("h1",J,"Loading..."))}}}),X={class:"q-pa-sm window-width"},Z={class:"card-item-list-page"},j={class:"card-item-content"},g="\u5168\u90E8",se=C({name:"ShipsDiv",__name:"ShipsDiv",props:{ships:{}},setup(p){const f=[m.FIGHTER,m.FRIGATE,m.DESTROYER,m.CRUISER,m.CAPITAL_SHIP],u=S(g),s=P(()=>{const o=new Set(p.ships.map(t=>t.size));return[[g,g],...[...o].map(t=>{var e;return[(e=V.get(t))!=null?e:t,t]})].map(t=>({label:t[0]+"("+v(p.ships,t[1]).length+")",value:t[1]}))});function b(o){return i.value.filter(t=>t.size==o).filter(t=>!t.isModule).sort((t,e)=>t.id.localeCompare(e.id))}function I(o){return i.value.filter(t=>t.size==o).length>0}function v(o,t){return o.filter(e=>t===g?!0:e.size===t)}const i=P(()=>v(p.ships,u.value));return(o,t)=>(l(),r(c,null,[d("div",X,[t[1]||(t[1]=W(" \u5927\u5C0F: ")),M(U,{name:"accepted_uiTags",modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),options:s.value,type:"radio",color:"primary",inline:""},null,8,["modelValue","options"])]),(l(),r(c,null,$(f,e=>{var a;return l(),r(c,{key:e},[I(e)?(l(),r(c,{key:0},[d("h4",null,R((a=D(V).get(e))!=null?a:e),1),d("div",Z,[(l(!0),r(c,null,$(b(e),n=>(l(),H(N,{"no-caps":"",flat:"",class:"card-item",style:{"align-self":"stretch"},key:n.id,to:{name:"ship",params:{id:n.id}}},{default:Q(()=>[d("div",j,[M(K,{ship:n},null,8,["ship"]),d("span",null,R(n.getDisplayName()),1)])]),_:2},1032,["to"]))),128))])],64)):F("",!0)],64)}),64))],64))}});export{se as _,K as a};
