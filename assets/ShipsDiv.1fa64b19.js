import{Q as w}from"./QOptionGroup.8bbf6a91.js";import{Q as P}from"./QBtn.5ab438c3.js";import{I as C,r as g,Z as W,J as D,K as p,U as c,Q as y,V as B,X as m,W as I,N as x,Y as $,_ as N,a as S,$ as V,L as Q,M as F,R as T,a0 as R,a1 as _,a2 as G}from"./index.24c33bca.js";import{_ as H}from"./WeaponSpriteDiv.5154ff90.js";const J=["src"],K={key:1},X=C({name:"ShipSpriteDiv",__name:"ShipSpriteDiv",props:{ship:{}},setup(f){const v=g(void 0),h=g(void 0),s=g(void 0);W(()=>{k(),M(),b()});async function k(){const r=[];for(const[i,u]of f.ship.weaponIdMap.entries())if(u){const t=$.getWeaponById(u),a=f.ship.allWeaponSlots.find(n=>n.id===i);if(t&&a){const n=await $.getWeaponCanvas(t,a.hardPoint);n&&r.push([t,a,n])}}v.value=r.sort((i,u)=>{const t=i[1].location,a=u[1].location;return t.x!==a.x?Math.abs(t.x)-Math.abs(a.x):Math.abs(t.y)-Math.abs(a.y)})}async function M(){let r=[];if(f.ship.moduleIdMap.size>0){for(const[i,u]of f.ship.moduleIdMap.entries())if(u){const t=$.getShipById(u),a=f.ship.allWeaponSlots.find(n=>n.id===i);if(t&&a){const n=await $.getShipCanvas(t);r.push([t,a,n])}}r=r.sort((i,u)=>{const t=i[0],a=u[0];if(t.isUnderParent()!==a.isUnderParent())return t.isUnderParent()?-1:1;if(t.isEmptyModule()!==a.isEmptyModule())return t.isEmptyModule()?-1:1;const n=i[1].location,o=u[1].location;return n.x!==o.x?Math.abs(o.x)-Math.abs(n.x):Math.abs(o.y)-Math.abs(n.y)})}h.value=r}async function b(){s.value=await N(f.ship)}return(r,i)=>{const u=D("ShipSpriteDiv",!0);return s.value&&h.value&&v.value?(p(),c("div",{key:0,style:B({position:"relative",width:s.value.left+s.value.right+"px",height:s.value.top+s.value.bottom+"px"})},[y("img",{decoding:"async",src:r.ship.sprite,style:B({position:"absolute",left:s.value.left+"px",top:s.value.top+"px",transform:`translate(${-r.ship.center.left}px, calc(-100% + ${r.ship.center.bottom}px))`})},null,12,J),(p(!0),c(m,null,I(v.value,([t,a,n])=>(p(),c("div",{key:a.id,style:B({position:"absolute",left:s.value.left+"px",top:s.value.top+"px",transformOrigin:`${n.left}px ${n.top}px`,transform:`translate(${-n.left}px, ${-n.top}px) translate(${a.location.x}px, ${-a.location.y}px) rotate(${360-a.angle}deg)`})},[x(H,{weapon:t,"is-hard-point":a.hardPoint},null,8,["weapon","is-hard-point"])],4))),128)),(p(!0),c(m,null,I(h.value,([t,a,n],o)=>{var e,l,A,O,z,L,E,U;return p(),c("div",{key:a.id,style:B({position:"absolute",left:s.value.left+"px",top:s.value.top+"px",transformOrigin:`calc(${n.left}px - ${(l=(e=t.moduleAnchor)==null?void 0:e.x)!=null?l:0}px) calc(${n.top}px - ${(O=(A=t.moduleAnchor)==null?void 0:A.y)!=null?O:0}px)`,transform:`translate(${-n.left}px, ${-n.top}px) translate(${(L=(z=t.moduleAnchor)==null?void 0:z.x)!=null?L:0}px, ${(U=(E=t.moduleAnchor)==null?void 0:E.y)!=null?U:0}px) translate(${a.location.x}px, ${-a.location.y}px) rotate(${a.angle===0?0:360-a.angle}deg)`,zIndex:t.isUnderParent()?-1:2+o})},[x(u,{ship:t},null,8,["ship"])],4)}),128))],4)):(p(),c("h1",K,"Loading..."))}}}),Y={class:"card-item-list-page"},Z={class:"card-item-content"},d="\u5168\u90E8",ae=C({name:"ShipsDiv",__name:"ShipsDiv",props:{ships:{},hiddenOptions:{type:Boolean,default:!1}},setup(f){const v=g(d),h=g(d),s=g("normal"),k=[{label:d,value:d},{label:"\u666E\u901A",value:"normal"},{label:"\u7A7A\u95F4\u7AD9",value:"station"},{label:"\u6A21\u5757",value:"module"}],M=S(()=>{const o=new Set(i.value.map(e=>e.size));return[[d,d],...[...o].map(e=>{var l;return[(l=R.get(e))!=null?l:e,e]})].map(e=>({label:e[0]+"("+t(i.value,e[1]).length+")",value:e[1]}))}),b=S(()=>{const o=new Set(i.value.map(e=>e.manufacturer).sort());return[d,...o].map(e=>({label:e+"("+a(i.value,e).length+")",value:e}))}),r=S(()=>_(k,o=>n(i.value,o).length)),i=S(()=>f.ships.map(o=>typeof o=="string"?$.getShipById(o):o).filter(o=>o!==void 0).sort(G)),u=S(()=>n(a(t(i.value,v.value),h.value),s.value));function t(o,e){return o.filter(l=>e===d?!0:l.size===e)}function a(o,e){return o.filter(l=>e===d?!0:l.manufacturer===e)}function n(o,e){return o.filter(l=>e===d?!0:e==="station"?l.station:e==="module"?l.isModule:!l.station&&!l.isModule)}return(o,e)=>(p(),c(m,null,[o.hiddenOptions?V("",!0):(p(),c(m,{key:0},[r.value.length>2?(p(),c(m,{key:0},[e[3]||(e[3]=y("span",null,"\u7C7B\u578B:",-1)),x(w,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value=l),options:r.value,type:"radio",color:"primary",inline:""},null,8,["modelValue","options"])],64)):V("",!0),M.value.length>2?(p(),c(m,{key:1},[e[4]||(e[4]=y("span",null,"\u5927\u5C0F:",-1)),x(w,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),options:M.value,type:"radio",color:"primary",inline:""},null,8,["modelValue","options"])],64)):V("",!0),b.value.length>2?(p(),c(m,{key:2},[e[5]||(e[5]=y("span",null,"\u8BBE\u8BA1\u7C7B\u578B:",-1)),x(w,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=l=>h.value=l),options:b.value,type:"radio",color:"primary",inline:""},null,8,["modelValue","options"])],64)):V("",!0)],64)),y("div",Y,[(p(!0),c(m,null,I(u.value,l=>(p(),Q(P,{"no-caps":"",flat:"",class:"card-item",style:{"align-self":"stretch"},key:l.id,to:{name:"ship",params:{id:l.id}}},{default:F(()=>[y("div",Z,[x(X,{ship:l},null,8,["ship"]),y("span",null,T(l.getDisplayName()),1)])]),_:2},1032,["to"]))),128))])],64))}});export{ae as _,X as a};
