import{Q as R}from"./QBtn.52ce3026.js";import{I as A,r as _,Z as C,J as D,K as r,U as p,Q as h,V as y,X as f,W as $,N as M,Y as g,_ as S,R as z,S as U,$ as W,L as N,M as H,a0 as V}from"./index.bcc23c19.js";import{c as O}from"./utils.217e0a5c.js";import{_ as Q}from"./WeaponSpriteDiv.119002df.js";const T=["src"],F={key:1},Y=A({name:"ShipSpriteDiv",__name:"ShipSpriteDiv",props:{ship:{}},setup(c){const m=_(void 0),v=_(void 0),n=_(void 0);C(()=>{d(),l(),u()});async function d(){const i=[];for(const[s,o]of c.ship.weaponIdMap.entries())if(o){const t=g.getWeaponById(o),e=c.ship.allWeaponSlots.find(a=>a.id===s);if(t&&e){const a=await g.getWeaponCanvas(t,e.hardPoint);a&&i.push([t,e,a])}}m.value=i.sort((s,o)=>{const t=s[1].location,e=o[1].location;return t.x!==e.x?Math.abs(t.x)-Math.abs(e.x):Math.abs(t.y)-Math.abs(e.y)})}async function l(){let i=[];if(c.ship.moduleIdMap.size>0){for(const[s,o]of c.ship.moduleIdMap.entries())if(o){const t=g.getShipById(o),e=c.ship.allWeaponSlots.find(a=>a.id===s);if(t&&e){const a=await g.getShipCanvas(t);i.push([t,e,a])}}i=i.sort((s,o)=>{const t=s[0],e=o[0];if(t.isUnderParent()!==e.isUnderParent())return t.isUnderParent()?-1:1;if(t.isEmptyModule()!==e.isEmptyModule())return t.isEmptyModule()?-1:1;const a=s[1].location,x=o[1].location;return a.x!==x.x?Math.abs(x.x)-Math.abs(a.x):Math.abs(x.y)-Math.abs(a.y)})}v.value=i}async function u(){n.value=await O(c.ship)}return(i,s)=>{const o=D("ShipSpriteDiv",!0);return n.value&&v.value&&m.value?(r(),p("div",{key:0,style:y({position:"relative",width:n.value.left+n.value.right+"px",height:n.value.top+n.value.bottom+"px"})},[h("img",{decoding:"async",src:i.ship.sprite,style:y({position:"absolute",left:n.value.left+"px",top:n.value.top+"px",transform:`translate(${-i.ship.center.left}px, calc(-100% + ${i.ship.center.bottom}px))`})},null,12,T),(r(!0),p(f,null,$(m.value,([t,e,a])=>(r(),p("div",{key:e.id,style:y({position:"absolute",left:n.value.left+"px",top:n.value.top+"px",transformOrigin:`${a.left}px ${a.top}px`,transform:`translate(${-a.left}px, ${-a.top}px) translate(${e.location.x}px, ${-e.location.y}px) rotate(${360-e.angle}deg)`})},[M(Q,{weapon:t,"is-hard-point":e.hardPoint},null,8,["weapon","is-hard-point"])],4))),128)),(r(!0),p(f,null,$(v.value,([t,e,a],x)=>{var b,I,k,w,E,B,L,P;return r(),p("div",{key:e.id,style:y({position:"absolute",left:n.value.left+"px",top:n.value.top+"px",transformOrigin:`calc(${a.left}px - ${(I=(b=t.moduleAnchor)==null?void 0:b.x)!=null?I:0}px) calc(${a.top}px - ${(w=(k=t.moduleAnchor)==null?void 0:k.y)!=null?w:0}px)`,transform:`translate(${-a.left}px, ${-a.top}px) translate(${(B=(E=t.moduleAnchor)==null?void 0:E.x)!=null?B:0}px, ${(P=(L=t.moduleAnchor)==null?void 0:L.y)!=null?P:0}px) translate(${e.location.x}px, ${-e.location.y}px) rotate(${e.angle===0?0:360-e.angle}deg)`,zIndex:t.isUnderParent()?-1:2+x})},[M(o,{ship:t},null,8,["ship"])],4)}),128))],4)):(r(),p("h1",F,"Loading..."))}}});const G={class:"items"},J={class:"item_img_section"},q=A({name:"ShipsDiv",__name:"ShipsDiv",props:{ships:{}},setup(c){const m=[S.FRIGATE,S.DESTROYER,S.CRUISER,S.CAPITAL_SHIP];function v(d){return c.ships.filter(l=>l.size==d).filter(l=>!l.isModule).sort((l,u)=>l.id.localeCompare(u.id))}function n(d){return c.ships.filter(l=>l.size==d).length>0}return(d,l)=>(r(),p(f,null,$(m,u=>{var i;return r(),p(f,{key:u},[n(u)?(r(),p(f,{key:0},[h("h4",null,z((i=U(W).get(u))!=null?i:u),1),h("div",G,[(r(!0),p(f,null,$(v(u),s=>(r(),N(R,{"no-caps":"",flat:"",class:"item",key:s.id,to:{name:"ship",params:{id:s.id}}},{default:H(()=>[h("div",null,[h("div",J,[M(Y,{ship:s},null,8,["ship"])]),h("span",null,z(s.getDisplayName()),1)])]),_:2},1032,["to"]))),128))])],64)):V("",!0)],64)}),64))}});export{q as _,Y as a};
